# 音乐编排MCP服务器

这是一个专门用于音乐编排的MCP服务器，可以根据频率列表和时长列表生成音乐曲谱。

## 功能特性

### 1. 生成曲谱
根据输入的频率列表(Hz)和时长列表(s)生成音乐文件
- 支持多种音频格式：WAV、MP3、OGG
- 可自定义采样率
- 自动添加淡入淡出效果

### 2. 音符转换
将音符名称转换为对应的频率
- 支持标准音符：C, C#, D, D#, E, F, F#, G, G#, A, A#, B
- 支持不同八度调整
- 基于A4=440Hz标准调音

### 3. 生成和弦
生成各种类型的和弦
- 支持和弦类型：大三和弦、小三和弦、减三和弦、增三和弦、大七和弦、小七和弦
- 可自定义根音和八度
- 自动生成和弦音频文件

## 使用方法

### 生成曲谱
```json
{
  "tool_name": "生成曲谱",
  "frequencies": [440, 523.25, 659.25],
  "durations": [0.5, 0.5, 0.5],
  "output_format": "wav",
  "sample_rate": 44100
}
```

### 音符转换
```json
{
  "tool_name": "音符转换",
  "notes": ["C", "D", "E"],
  "octave": 4
}
```

### 生成和弦
```json
{
  "tool_name": "生成和弦",
  "chord_type": "major",
  "root_note": "C",
  "octave": 4,
  "duration": 2.0
}
```

## 技术实现

### 依赖库
- **pydub**: 音频处理和格式转换
- **numpy**: 数值计算和音频信号生成
- **scipy**: 音频文件写入（备用方案）

### 音频生成算法
- 使用正弦波生成纯净音调
- 支持多音轨叠加（和弦）
- 自动添加淡入淡出效果防止爆音
- 支持多种采样率和音频格式

### 音符频率表
基于A4=440Hz的标准十二平均律：
```
C4: 261.63 Hz    C#4: 277.18 Hz
D4: 293.66 Hz    D#4: 311.13 Hz
E4: 329.63 Hz    F4: 349.23 Hz
F#4: 369.99 Hz   G4: 392.00 Hz
G#4: 415.30 Hz   A4: 440.00 Hz
A#4: 466.16 Hz   B4: 493.88 Hz
```

### 和弦结构
- **大三和弦**: 根音 + 大三度 + 纯五度
- **小三和弦**: 根音 + 小三度 + 纯五度
- **减三和弦**: 根音 + 小三度 + 减五度
- **增三和弦**: 根音 + 大三度 + 增五度
- **大七和弦**: 大三和弦 + 大七度
- **小七和弦**: 小三和弦 + 小七度

## 输出文件

生成的音频文件保存在 `logs/audio_temp/` 目录下，文件名格式为：
```
music_composition_{timestamp}.{format}
```

## 错误处理

- 参数验证：检查必需参数和参数类型
- 频率验证：确保频率值为正数
- 长度匹配：验证频率列表和时长列表长度一致
- 音符验证：检查音符名称是否有效
- 和弦类型验证：检查和弦类型是否支持

## 扩展功能

### 支持的功能扩展
1. **更多和弦类型**: 增加九和弦、十一和弦等复杂和弦
2. **节奏模式**: 支持更复杂的节奏和拍子
3. **音色选择**: 支持方波、三角波、锯齿波等音色
4. **效果器**: 支持混响、延迟、合唱等音频效果
5. **MIDI导入导出**: 支持MIDI文件格式

### 性能优化
- 音频缓存机制
- 批量生成优化
- 内存使用优化
- 多线程处理

## 注意事项

1. **音频质量**: 生成的音频为单音轨正弦波，适合简单旋律和和弦
2. **文件大小**: 长时间音频可能产生较大文件
3. **依赖要求**: 需要安装pydub和相关音频编解码器
4. **内存使用**: 大型音频生成需要足够内存空间

## 故障排除

### 常见问题
1. **pydub未安装**: 运行 `pip install pydub` 安装
2. **音频编解码器问题**: 确保系统安装了ffmpeg或libav
3. **权限问题**: 确保有写入输出目录的权限
4. **内存不足**: 尝试生成较短的音频片段

### 调试方法
- 检查返回的JSON状态信息
- 查看生成的音频文件是否存在
- 验证输入参数格式是否正确
- 检查系统依赖是否完整